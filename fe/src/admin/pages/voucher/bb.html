<!DOCTYPE html>
<html ng-app="myApp">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<!----css---->
	<link rel="stylesheet" href="common/static/css/custom.css" />

	<!--google fonts -->
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet" />

	<!--google material icon-->
	<link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet" />
	<!-- AngularJS -->
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular-route.min.js"></script>

	  <!-- toastr -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chosen/1.8.7/chosen.jquery.min.js"></script>
</head>
<body ng-controller="MyController" class="container">
    <form ng-submit="submitForm()">
        <select id="chosen-select" data-placeholder="Begin typing a name to filter..." multiple style="width: 100%;" class="chosen-select" ng-model="selectedBears" ng-change="updateSelection()">
            <option ng-repeat="item in customerTypes" value="{{ item.id }}">{{ item.name }}</option>
        </select>
        <button type="submit">Submit</button>
    </form>
    <script>
        var app = angular.module('myApp', []);
        app.controller('MyController', function($scope, $http, $timeout) {
            $scope.customerTypes = [];
            // $scope.selectedBears = []; 
            $scope.selectedBears = ['1', '2', '3'];

            $scope.getAllCustomerType = function() {
                $http.get('http://localhost:8080/api/admin/customerType/all').then(function(res) {
                    $scope.customerTypes = res.data;
                    console.log($scope.customerTypes);

                    // Use $timeout to ensure Chosen is re-initialized after data is assigned
                    $timeout(function() {
                        $(".chosen-select").trigger("chosen:updated");
                    }, 0);
                });
            };

            $scope.updateSelection = function() {
                console.log("Selected IDs: ", $scope.selectedBears);
            };

            // Call getAllCustomerType on load
            $scope.getAllCustomerType();

            // Initialize Chosen
            $scope.initChosen = function() {
                $('#chosen-select').chosen({
                    no_results_text: "Oops, nothing found!"
                }).change(function() {
                    $scope.$apply(function() {
                        // Update selectedBears with the IDs of the selected items
                        $scope.selectedBears = $('#chosen-select').val();
                        $scope.updateSelection();
                    });
                });
            };

            // Call initChosen when the document is ready
            angular.element(document).ready(function() {
                $scope.initChosen();
            });

            $scope.submitForm = function() {
                console.log('Selected Bears:', $scope.selectedBears);
            };
        });
    </script>
</body>
</html>